---
title: "Untitled"
author: "Cecilia Aparicio"
date: "Mayo 2021"
number_sections: true
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,warning = FALSE,message = FALSE)
``` 

```{r}
library(tinytex)
library(knitr)
library(dplyr)
library(FactoMineR)
library(Factoshiny)
library(stringr)
library(xtable)
library(kableExtra)
library(rmarkdown)
```
## Resumen ejecutivo

>introducir acá de qué se va a tratar el proyecto: estudio de principales variables que explican el desarrollo sustentable, comparación entre los 80 y los 90 para identificar cambios que sean indicios de avance en la aplicación de politicas energeticas que favorezcan la sustentabilidad del desarrolloetc etc etc##.

### Desarrollo sustentable


Def de desarrollo sustentable: desarrollo que distribuye más equitativamente los beneficios del progreso económico, protege al medioambiente nacional y mundial en beneficio de las futuras generaciones y mejore genuinamente la calidad de vida.


Existe un fuerte vínculo entre el desarrollo y la energía, siendo este último un insumo fundamental para ello. Sin embargo, debe prestarse especial atención al efecto negativo que puede tener tal desarrollo en el medioambiente, y por tanto, en la disponibilidad futura de recursos energéticos. Aquí es donde entre en juego la noción de sustentabilidad.


El estudio del desarrollo sustentable entonces, deberá contemplar varias aristas. Desde la CEPAL(1997) se sugiere focalizarse en la dimensión *política, económica, social, y ambiental*. Dada la complejidad de las mismas, no pueden medirse directamente a través de un único indicador.


>*"Clasificar países respecto a un tema multidimensional como el desarrollo sustentable es una tarea compleja, que involucra una cantidad de juicios de valor de distintos niveles, muchas veces implícitos en la selección de indicadores, su normalización, la valoración relativa, etc."* (OLADE/CEPAL/GTZ, 1997). 


En este trabajo se intentará superar tales dificultades.

Nos basaremos en el estudio realizado por OLADE, CEPAL, y GTZ "....inserte nombre aki" , a los efectos de identificar posibles relaciones entre la situación energética y la sustentabilidad de cada país. Además, se buscarán posibles cambios que se hayan dado en el tiempo de estas relaciones, que evidencien un avance en el desarrollo sustentable entre la década de los 80 y 90. Para ello, compararemos datos del año 1984 y 1996.


## Patrones de situación energética en AL

En el análisis de la sustentabilidad a nivel regional, CEPAL/OLADE/GTZ (1997) define cuatro patrones:


**A)** Alto ingreso medio, moderada desigualdad social, baja integración productiva, fuerte dependencia de exportaciones energéticas.\
**B)** Alta o moderada integración y diversificación productiva con gran absorción interna, marcada o moderada diferenciación social, importante base de recursos naturales, autosuficientes o moderadamente independientes de las importaciones energéticas. \
**C)** Moderada o alta integración y diversificación productiva interna, desigualdad social atenuada, exportaciones diversificadas basadas en recursos naturales. \
**D)** Bajo nivel de desarrollo relativo basado en recursos naturales y exportación de productos primarios/mineros/energéticos. \
**E)** Bajo o muy bajo grado de desarrollo, con reducida dotación de recursos naturales. \

La clasificación realizada por los autores fue la siguiente:


| **Clasificación** | **Países**                                                               |  
|:-----------------:|:------------------------------------------------------------------------:| 
| A                 | Venezuela, Trinidad y Tobago, Barbados                                   | 
| B                 | Argentina, Brasil, Chile, Uruguay, Paraguay                              | 
| C                 | Colombia, Costa Rica, México, Panamá, Jamaica                            | 
| D                 | Bolivia, Ecuador, Guyana, Nicaragua, Perú, Suriname, Cuba                | 
| E                 | Guatemala, Honduras, República Dominicana, El Salvador, Granada, Haití   | 
>Ver cómo se relaciona esta clasificación con la anterior.


### Indicadores:


* Dimensión política: la autarquía energética (% importaciones de energía) \
* Dimensión económica: productividad energética e industrial, calidad del suministro eléctrico, intensidad energética, uso racional de la energía en sectores productivos, (Prod_Ind, Prod_Ene, C_IND, C_trans, O_pripc, O_SECpc, ConsENpc) \
* Dimensión social: cobertura de necesidades básicas de energía eléctrica en los hogares,consumo neto de electricidad de la poblacion , nivel de ingresos, oferta/demanda de energía secundaria per-cápita (%consumo de energía residencial, PBI pc , C_ELEC_pc, O_SECpc, X.C_SEC). \
* Ambiental: nivel de emisión de CO2. \


## Patrones relacionados a las dimensiones de sustentabilidad en AL


Teniendo en cuenta los indicadores antes mencionados, la evaluación de ellos en la región llevaron a la conformación de 4 grandes "bloques" con 2 sub-bloques cada uno, que comparten distintas características.


```{r Cuadro1, fig.align = 'center', out.width="90%",fig.cap = "Cuadro extraído de Energía y desarrollo sustentable en América Latina y El Caribe. OLADE/CEPAL/GTZ, 1997."}
knitr::include_graphics(here::here("patrones.png"))
```


Se observa que existen ciertas correspondencias entre los patrones aquí detallados y los de situación energética, algunos más claros que otros.


|Grupo Situación        | Grupo Sustentabilidad |
|:---------------------:|:---------------------:|
| I                     | A                     |
| II                    | C,D                   |
| III                   | B                     |
| IV                    | C,D,E                 |

> En estos patrones nos vamos a basar para reproducrilo con ACP y comparar los cambios entre el 84 y el 96


Contamos con información de 24 países y 14 variables para examinar, todas ellas cuantitativas, por lo que se procede a realizar un Análisis de Componentes Principales (ACP).
Como primer paso, y de acuerdo a lo sugerido, se estandarizan las variables por practicidad.


```{r datos, include=FALSE,cache= TRUE}
Energia1 <- read.delim("C:/Users/cecil/OneDrive/Documentos/facu/ESTADISTICA/AMulti/Proyecto/Energia1.txt")
pais <-str_sub(Energia1$PAISES,1,-3)
anio <- str_sub(Energia1$PAISES,-2)
anio<-paste(19,anio,sep="" )
anio<-as.numeric(anio)
for (i in 1:144) {
 pais[i]= gsub(", ","_",pais[i])
 pais[i]= gsub(" _","_",pais[i])
 pais[i]= gsub("_", " ",pais[i])
}
Energia1$Año<-anio
Energia1$paises_n<-pais
Energia_st<-cbind(Energia1[,c(1,16,17)],scale(Energia1[,2:15]))
rownames(Energia_st)=Energia_st$PAISES
rownames(Energia1)=Energia1$PAISES
```

>Arreglar todas las tablas posteriores, no se ven bien en PDF

#### Países contenidos en los datos:


```{r}
kable(unique(pais), booktabs=TRUE)
```


#### **Datos**


Primeras 5 filas:


```{r}
kable(head(Energia1[,2:15]),booktabs=TRUE, format="latex") %>% 
 scroll_box(width="100%")
```


#### **Datos estandarizados**

Primeras 5 filas:


```{r}
kable(head(Energia_st[4:17])) %>% 
  kable_styling(full_width = F, fixed_thead = T)
```


## Situación regional en 1984


Matriz de correlaciones entre variables:


```{r correlaciones 1984}
kable(cor(Energia1[2:15])) %>% 
  kable_styling(full_width = F, fixed_thead = T)
```


Para el año 1984, observamos que existe correlaciones altas (>0.70) en varios casos. Se destaca principalmente la correlación entre la productividad energética (*Prod_Ene*) con el ingreso per cápita (*PBIpc*), el consumo energético per cápita (*ConsENpc*) con la oferta primaria de energía per cápita (*O_PRIpc*) y con el consumo eléctrico neto (*C_ELEpc*), y de esta última también con la oferta primaria de energía per cápita.

La existencia de correlación alta entre las variables justifica el uso de ACP. La relación entre ellas puede tener como resultado información redundante, la cual intentaremos "aislar" con este método.


### Análisis de componentes principales para 1984


La variabilidad de los datos es captada en un 46.54% por el primer eje de inercia creado a partir de ACP. Sumar una segunda dimensión incrementa este porcentaje a 63.3%. Se capta más del 80% de la varianza si se contemplan al menos 4 dimensiones. Según la regla de Kaiser, deberían retenerse aquellos componentes que tengan una varianza mayor o igual a 1. En nuestro caso, eso implicaría trabajar con 4 componentes.


```{r,include=FALSE}
acp1984=PCA(Energia_st[Energia_st$Año==1984,c(4:17)])
res.pca1984 = PCA(Energia_st[Energia_st$Año==1984,c(4:17)], scale.unit=TRUE, ncp=5, graph = FALSE)
```
```{r vp 1984, results='asis'}
vp84<-res.pca1984[["eig"]][,1] %>% 
  as.data.frame()
colnames(vp84)="Valores propios"
kable(vp84,booktabs=TRUE)
```

```{r plot eigen84}
vp84<-cbind.data.frame(vp84,res.pca1984[["eig"]][,3])
colnames(vp84)=c("Valores propios","% acumulado de varianza")
ggplot(vp84,aes(x=seq(1:14),y=`Valores propios`))+ ##mejorar el gráfico
  geom_line()+
  geom_label(aes(label=round(`% acumulado de varianza`,2)))+
  labs(title = "Varianza explicada por cada dimensión",x="Número del valor propio", y="Valores propios")

```


Por otra parte, siguiendo el criterio *"Broken-sitcks"*, que sugiere retener tantos componentes que expliquen una proporción mayor a la varianza que la esperada si se "dividiera" en $p$ partes. Para nuestro caso, implicaría también retener en el entorno de 3 a 4 componentes:


```{r criterio BS 1984, fig.cap="Criterio Broken-sticks para la elección de componentes",cache=TRUE}
evplot = function(ev) {  ### FUNCION UTIL PARA ELEGIR COMP CON EL CRITERIO BS
  # Broken stick model
  n = length(ev)  
  bsm = data.frame(j=seq(1:n), p=0)  
  bsm$p[1] = 1/n  
  for (i in 2:n) bsm$p[i] = bsm$p[i-1] + (1/(n + 1 - i))  
  bsm$p = 100*bsm$p/n  
  # Plot eigenvalues and % of variation for each axis  
  op = par(mfrow=c(2,1),omi=c(0.1,0.3,0.1,0.1), mar=c(1, 1, 1, 1))  
  barplot(ev, main="Valores propios", col="bisque", las=2)  
  abline(h=mean(ev), col="red")  
  legend("topright", "Valor propio medio", lwd=1, col=2, bty="n")  
  barplot(t(cbind(100*ev/sum(ev), bsm$p[n:1])), beside=TRUE,   
          main="% Inercia", col=c("bisque",2), las=2)  
  legend("topright", c("% Valor propio", "Criterio Broken Stick"),   
         pch=15, col=c("bisque",2), bty="n")  
  par(op)  
}
evplot(vp84[,2]^2)
```


La pérdida de información en caso de trabajar con el plano principal sería de 36.7% con respecto a la nube de datos original, mientras que considerar 4 implica perder únicamente 13.8%.

Una vez determinado, de forma preliminar, la dimensión en que se trabajará, realizamos el cálculo de componentes y su presentación gráfica para observar los resultados y confirmarlo. 

Desde la perspectiva de las variables, encontramos que las variables mejor representadas ($|\rho| \geq 0.6$) por las dimensiones elegidas son (en orden descendente):

* Dimensión 1: Oferta de energía secundaria per-cápita, consumo neto de electricidad per-cápita, consumo residencial de energía, consumo energético final per-cápita, y el Producto Bruto Interno per-cápita, consumo de energía del sector transporte, oferta de energía primaria per- cápita, consumo industrial de energía. \
* Dimensión 2: Productividad industrial energética, productividad energética. \
* Dimensión 3: Emisión de CO2 por unidad de consumo energético, emisión de CO2 per-cápita. \
* Dimensión 4: Proporción de energía importada sobre el total de la oferta. \

Resulta claro entonces que el tercer componente representará la *dimensión ambiental*, la cuarta representa la *dimensión política* (autarquía política dada por el nivel de dependencia energético), mientras que el primero representará la *dimensión social* (abastecimiento de energía a distintos sectores de la sociedad, nivel de ingresos, etc.), y el segundo la *dimensión económica*.

A su vez, entendemos que las dimensiones más relevante son la social y la económica, dado que son las que explican en mayor medida las variaciones de los datos. Siendo así, podemos restringir el análisis al plano principal, dónde estaríamos prescindiendo princpalmente, del aporte de las variables Importaciones y emisión de CO2 per cápita.

Visualizamos en los correspondientes círculos de correlaciones:


```{r, fig.cap= "Dimensiones 1 y 2."}
plot.PCA(res.pca1984,choix='var',habillage = 'contrib',title="Círculo de correlaciones")
```


```{r,fig.cap= "Dimensiones 3 y 4."}
plot.PCA(res.pca1984,choix = "var",axes=c(3,4),habillage='cos2', title = "Círculo de correlaciones")
```

Las totalidad de las variables se encuentran bien representadas al tener en cuenta 4 dimensiones.

En lo que respecta a los individuos (Países):

```{r, fig.cap="Dimensiones 1 y 2."}
plot.PCA(res.pca1984,choix = "ind",title="Gráfico perspectiva de Países",col.ind='#ED1536')
```

Si bien se observa mayor dispersión en el caso de la representación de los países, destacamos los mejor representados ($\cos^2 \geq 0.5$) al igual que lo hicimos con las variables:

* Dimensión 1: Haití, Nicaragua, El Salvador, Guatemala, México, Argentina, Trinidad y Tobago. \
* Dimensión 2: Uruguay, Guyana. \ 


```{r, fig.cap="Dimensiones 3 y 4."}
plot.PCA(res.pca1984,axes=c(3,4),title="Gráfico perspectiva de Países",col.ind='#ED1536')
```

Las dimensiones 3 y 4 no representan lo suficiente a ningún país.

>Evaluar en conjunto variables/paises. Armar los clusters y sacar conclusiones para el 84.

>Hacer exactamente lo mismo para el 96, sólo hay que copiar y pegar el mismo código y ver si hay cambios importantes a destacar o no.




```{r summary de ACP, va en anexos}
summary(res.pca1984)
```




\

```{r summary de las variables originales va en anexos}
(summary(Energia1[,2:15]))
```
